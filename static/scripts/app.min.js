!function(){"use strict";var e="goal-grid-login-prototype",r="AIzaSyA8izaYTPKoj0roPVeBH1verzc8aoHGcx0",t="669303885284",o={apiKey:r,authDomain:e+".firebaseapp.com",databaseURL:"https://"+e+".firebaseio.com",projectId:e,storageBucket:e+".appspot.com",messagingSenderId:t};firebase.initializeApp(o);var a=angular.module("goalgrid",["ngResource","ngCookies","angularjs-dropdown-multiselect","mp.autoFocus","ui.bootstrap","colorpicker.module","angular-packery","angular-sortable-view","angularSpectrumColorpicker","ngTable","ngFileUpload","ngOrderObjectBy","firebase","ui.router"]);a.run(["$transitions","$state",function(e,r){var t=function(e){"AUTH_REQUIRED"===e.error().detail&&(console.log("AUTH_REQUIRED. Redirecting to login."),r.go("login"))};e.onError({},t)}]),a.config(["$stateProvider","$urlRouterProvider",function(e,r){r.otherwise("home"),e.state("login",{url:"/login",controller:"FirebaseuiController",templateUrl:"static/views/login.html"}).state("home",{url:"/home",controller:"MainCtrl",templateUrl:"static/views/main.html",resolve:{currentAuth:["FirebaseuiFactory","userFactory","accountFactory",function(e,r,t){var o=e.isLoggedIn();return o.then(function(){var o=e.getUser();return t.getCurrentUserData(o).then(function(){return r.currentUser.id=o.uid,o.displayName?r.currentUser.name=o.displayName:r.currentUser.name=o.email,r.currentUser.role=t.currentUserData.role,o})})}]}}).state("404",{url:"/404",templateUrl:"static/views/404.html"})}]),angular.module("goalgrid").config(["$httpProvider",function(e){e.defaults.withCredentials=!0,e.defaults.xsrfCookieName="_xsrf",e.defaults.xsrfHeaderName="X-CSRFToken"}])}();
!function(){"use strict";angular.module("goalgrid").controller("AccountCtrl",["$scope","accountFactory","userFactory",function(e,t,c){e.accountsModal={},e.accountsModal.newAccountsLoading={},e.accountsModal.newGroup={selectedManagersArray:[],selectedMembersArray:[]},e.accountsModal.justManagers=t.justManagers,e.newAccount={},e.currentEdit={},e.accountsModal.currentGroupEdit={},e.accountsModal.groupDropdownSettings={displayProp:"name",enableSearch:!1,smartButtonMaxItems:5,externalIdProp:""},e.accountsModal.dropdownTexts={buttonDefaultText:"Select",dynamicButtonTextSuffix:"selected",checkAll:"Select All",uncheckAll:"Deselect All"},e.accountsModal.accountDropdownSettings={displayProp:"username",enableSearch:!0,smartButtonMaxItems:5,externalIdProp:""},e.accountsModal.getGroupMemberCount=t.getGroupMemberCount,e.accountsModal.getGroupManagerCount=t.getGroupManagerCount,e.resetNewAccount=function(){e.newAccount={selectedMemberOfArray:[],selectedManagerOfArray:[]}},e.resetAccountModal=function(){e.resetNewAccount(),e.accountsModal.newGroup={selectedManagersArray:[],selectedMembersArray:[]},e.currentEdit={},e.currentGroupEdit={}},e.accountsModal.addGroup=function(){t.addGroup(e.accountsModal.newGroup),e.accountsModal.newGroup={selectedManagersArray:[],selectedMembersArray:[]}},e.accountsModal.toggleDeleteGroupMode=function(t){e.accountsModal.currentGroupEdit[t].deleteMode=!e.accountsModal.currentGroupEdit[t].deleteMode},e.accountsModal.editGroup=function(c){e.accountsModal.currentGroupEdit[c.id]={};var o=[],n=[];angular.forEach(c.members,function(e,c){t.accounts[c]&&o.push(t.accounts[c])}),angular.forEach(c.managers,function(e,c){t.accounts[c]&&n.push(t.accounts[c])}),c.selectedMembersArray=o,c.selectedManagersArray=n,e.accountsModal.currentGroupEdit[c.id].group=c,e.accountsModal.currentGroupEdit[c.id].deleteMode=!1,e.accountsModal.currentGroupEdit[c.id].stopDelete=!1},e.accountsModal.saveGroup=function(c){t.updateGroup(e.accountsModal.currentGroupEdit[c.id].group).then(function(){}),e.accountsModal.currentGroupEdit[c.id]={}},e.accountsModal.deleteGroup=function(c){t.deleteGroup(c),e.accountsModal.currentGroupEdit[c]={}},e.addAccount=function(){e.accountsModal.newAccountsLoading[e.newAccount.username]={username:e.newAccount.username},t.addAccount(e.newAccount).then(function(t){delete e.accountsModal.newAccountsLoading[t.username]}),e.resetNewAccount()},e.toggleDeleteAccountMode=function(t){0===t||c.currentUser.id===t?e.currentEdit[t].stopDelete=!0:e.currentEdit[t].deleteMode=!e.currentEdit[t].deleteMode},e.editAccount=function(c){e.currentEdit[c.id]={};var o=[],n=[];c.groups&&c.groups.memberOf&&angular.forEach(c.groups.memberOf,function(e,c){o.push(t.allGroups[c])}),c.groups&&c.groups.managerOf&&angular.forEach(c.groups.managerOf,function(e,c){n.push(t.allGroups[c])}),c.selectedMemberOfArray=o,c.selectedManagerOfArray=n,e.currentEdit[c.id].account=c,e.currentEdit[c.id].deleteMode=!1,e.currentEdit[c.id].stopDelete=!1},e.saveAccount=function(c){t.updateAccount(e.currentEdit[c.id].account).then(function(){}),e.currentEdit[c.id]={}},e.deleteAccount=function(c){t.deleteAccount(c),e.currentEdit[c]={}},e.resetAccountModal()}])}();
!function(){"use strict";angular.module("goalgrid").controller("FirebaseuiController",["FirebaseuiFactory",function(e){this.signInSuccess=function(e){return!0};var i="#/home",n={callbacks:{signInSuccess:this.signInSuccess,uiShown:function(){document.getElementById("loader").style.display="none"}},signInFlow:"redirect",signInSuccessUrl:i,signInOptions:[{provider:firebase.auth.EmailAuthProvider.PROVIDER_ID,requireDisplayName:!0}]};e.ui.start("#firebaseui-auth-container",n)}])}();
!function(){"use strict";angular.module("goalgrid").controller("GoalCtrl",["$scope","goalFactory","viewFactory","modalData",function(l,o,a,e){l.goalModal={},l.goalModal.colorPaletteOptions={allowEmpty:!0,showPaletteOnly:!0,showInput:!0,togglePaletteOnly:!0,preferredFormat:"name",palette:o.colorPaletteChoices,replacerClassName:"form-control"},l.goalModal.linkColorChoices=o.colorPaletteChoices,l.goalModal.allGoalTypes=o.allGoalTypes,l.goalModal.modalGoalType=o.currentGoalModalType,l.goalModal.linkedGoalsDropdownSettings={displayProp:"goalText",groupByTextProvider:function(l){var a=o.allGoalTypes[l];return a?a.name:""},enableSearch:!0},l.goalModal.linkedGoalsDropdownTexts={buttonDefaultText:"Select linked goals",dynamicButtonTextSuffix:"linked",checkAll:"Select All",uncheckAll:"Deselect All"},l.goalModal.modalState=e,e.editOnly?l.goalModal.modalGoals=[o.visibleGoalsFlatObject[e.goal.id]]:o.currentUserGoals?l.goalModal.modalGoals=o.currentUserGoals[l.goalModal.modalGoalType.id]:l.goalModal.modalGoals={},l.goalModal.modalGoalLinkOptions=o.filterOutOneTypeOfGoal(l.goalModal.modalGoalType.id),l.newGoal=o.newGoal,l.currentEdit=o.currentEdit,l.goalModal.getLinkedGoals=function(l){var a=[];return l&&l.linkColor?(angular.forEach(o.linkGroups[l.linkColor],function(e){if(e.id!==l.id){var t=o.visibleGoalsFlatObject[e.id];a.push(t)}}),a):[]},l.resetGoalsModal=function(){o.resetGoalModal(l.goalModal.modalGoalType.id),l.currentEdit=o.currentEdit},l.addGoal=function(){l.newGoal.goalTypeID=l.goalModal.modalGoalType.id;var t=angular.copy(l.newGoal);o.addGoal(t,e.currentViewDate).then(function(){a.addGoalToAllViews(t),l.goalModal.modalState.addOnly&&(l.resetGoalsModal(),l.$close())}),o.resetNewGoal(l.goalModal.modalGoalType.id)},l.editGoal=function(o){l.currentEdit[o.id]={},l.currentEdit[o.id].goal=angular.copy(o)},l.saveGoal=function(a){var e=l.currentEdit[a.id].goal;o.updateGoal(e).then(function(){l.goalModal.modalState.editOnly&&(l.resetGoalsModal(),l.$close())}),l.currentEdit[a.id]={}},l.toggleDeleteGoalMode=function(o){l.currentEdit[o].deleteMode=!l.currentEdit[o].deleteMode},l.goalModal.toggleGoalInactiveAfter=function(a){var e=moment().valueOf();o.toggleGoalInactiveAfter(a,e),a.inactiveAfterTimestamp&&(l.currentEdit[a.id]={},l.goalModal.modalState.editOnly&&(l.resetGoalsModal(),l.$close()))},l.deleteGoal=function(e,t){a.removeGoalFromAllViews(e,t),o.deleteGoal(e),l.currentEdit[e]={},l.goalModal.modalState.editOnly&&(l.resetGoalsModal(),l.$close())},angular.equals(o.currentEdit,{})&&l.resetGoalsModal(),l.goalModal.modalState.addOnly&&l.$watch("goalModal.modalGoalType.id",function(a){o.resetGoalModal(a),l.goalModal.modalGoalLinkOptions=o.filterOutOneTypeOfGoal(a)})}])}();
!function(){"use strict";angular.module("goalgrid").controller("MainCtrl",["$scope","$filter","$location","userFactory","goalFactory","accountFactory","pictureFactory","viewFactory","reportsFactory","$modal","noteFactory","FirebaseuiFactory",function(e,a,n,t,r,i,o,l,s,c,u,m){e.main={},e.main.logOut=function(){u.visibleNotesFlatObject.$destroy&&u.visibleNotesFlatObject.$destroy(),s.unreadNoteIDs.$destroy&&s.unreadNoteIDs.$destroy(),m.logout()},e.main.isInitialLoadDone=!1,e.main.getVisibleNotesForCurrentUserByCurrentView=function(){var a,n;return e.main.isViewDaily(e.main.currentView)?(a=e.main.currentViewDate,n="MM/dd/yyyy"):e.main.isViewMonthly(e.main.currentView)?(a=e.main.currentViewDate,n="MM/yyyy"):e.main.isViewYearly(e.main.currentView)?(a=e.main.currentViewDate,n="yyyy"):(a=void 0,n=void 0),u.getSingleUserNotes(e.main.currentUser.id,a,n,e.main.currentView.name)},e.main.addOrEditNoteModal=function(a,n){var r={editOnly:!1,addOnly:!0,noteView:l.currentView.name,allowPrivate:!0,user:{}};if(u.resetNoteModal(l.currentView.name),void 0!==n){r.editOnly=!0,r.addOnly=!1,r.note=u.visibleNotesFlatObject[n];var o=u.isManagerNote(r.note),s=u.isThisUsersNote(r.note),c=u.isCurrentUserManagerOfNote(r.note);if(!s&&!c||s&&o)return;u.currentEdit[n]={},u.currentEdit[n].note=angular.copy(r.note)}e.main.showReports?r.viewDate=new Date:r.viewDate=e.main.currentViewDate,void 0===a||a===t.currentUser.id?(r.user=angular.copy(t.currentUser),r.user.name||(r.user.name=r.user.username),r.managerID=null,r.managerName=null):(r.user=angular.copy(i.accounts[a]),r.user.name=r.user.username,r.managerID=t.currentUser.id,r.managerName=t.currentUser.name),u.openNoteModal(l.currentView.name,e,r)};var d=function(a,n,t,r){return c.open({animation:!0,templateUrl:n,controller:t,scope:e,size:r,resolve:{modalData:["$q",function(e){return e.when(a)}]}})};e.main.openHelpModal=function(){var e="static/views/modals/help_and_tips/help.html";return d({},e,"","lg")},e.main.gridViewClickEmptySpace=function(a,n){n&&r.resetGoalModal(n);var t={editOnly:!1,addOnly:!0};e.main.openGoalModal(n,t)},e.main.toggleChartViewRearrangeGoals=function(){e.main.linkViewDragEnabled=e.main.gridViewRearrangeGoals},e.main.gridViewClickGoal=function(a){var n=r.visibleGoalsFlatObject[a];r.resetGoalModal(n.goalTypeID),r.currentEdit[a]={},r.currentEdit[a].goal=angular.copy(n);var t={editOnly:!0,addOnly:!1,goal:n},i="static/views/modals/goals_inner.html";e.main.openGoalModal(n.goalTypeID,t,i)},e.main.openGoalModal=function(a,n,t){return void 0===n&&(e.main.setModalGoalType(a),n={editOnly:!1,addOnly:!1}),void 0===t&&(t="static/views/modals/goals_inner.html"),e.main.currentView.allowGoalLinkUI&&(n.allowGoalLinkUI=!0),n.currentViewDate=e.main.currentViewDate,d(n,t,"GoalCtrl")},e.main.openUnreadNotes=function(a){e.main.showReportsNoteSection=!0;var n={editOnly:!1,addOnly:!1},t="static/views/modals/unread_notes_mobile.html";return n.allowGoalLinkUI=!0,n.currentViewDate=e.main.currentViewDate,d(n,t,"ReportsCtrl")},e.main.getUnreadNotesForSingleUser=function(e){return u.getUnreadNotes(e)},e.main.getBackgroundColorStyleFromGoal=function(a,n){if(!e.main.currentView.editPercentages||n)return{"background-color":a.color}},e.main.colorPercentageSquare=function(a,n,t){return r.colorPercentageSquare(a,n,t,e.main.currentViewDate,!0)},e.main.addPicToThisView=function(a,n,t){l.addPicToView(e.main.currentView.id,a,n,t),o.addViewIDToPicture(t,e.main.currentView.id)};var y=function(a){a?e.main.pictureForModal=angular.copy(o.allPictures[a]):(e.main.pictureForModal={src:"",viewIDs:{ignoreme:!0},selectionType:"file"},e.main.pictureForModal.viewIDs[e.main.currentView.id]=!0),e.main.pictureForModal.selectionType||(e.main.pictureForModal.selectionType="url")};e.main.setPictureAndOpenModal=function(a,n,t,r){var i={};i.currentView=e.main.currentView,i.viewLeft=n,i.viewFirstColumn=t,i.picListIndex=r,null===a&&(i.addOnly=!0),y(a),e.main.openPictureModal(i)},e.main.openPictureModal=function(a){var n="PictureCtrl",t="static/views/modals/pictures/pic_select.html";return void 0===a&&(a={currentView:e.main.currentView}),(e.main.currentView.allowPictureEdit||a.addOnly)&&(t="static/views/modals/pictures/pic_edit.html"),d(a,t,n)},e.main.toggleChartViewColorByLinkPath=function(){r.recolorGoals()},e.main.isObject1EqualToObject2=function(e,a){return angular.equals(e,a)},e.main.getObjectLength=function(e){if(!e)return 0;var a=e.length;return void 0!==a?a:(a=0,angular.forEach(e,function(e){a++}),a)},e.main.isViewDaily=function(e){var a=l.getViewSingleGoalTypeID(e);return null!==a&&r.isGoalDaily({goalTypeID:a})},e.main.isViewMonthly=function(e){var a=l.getViewSingleGoalTypeID(e);return null!==a&&r.isGoalMonthly({goalTypeID:a})},e.main.isViewYearly=function(e){var a=l.getViewSingleGoalTypeID(e);return null!==a&&r.isGoalYearly({goalTypeID:a})},e.main.isViewLifetime=function(e){var a=l.getViewSingleGoalTypeID(e);return null!==a&&r.isGoalLifeTime({goalTypeID:a})},e.main.incrementCurrentViewDateByViewAmount=function(a,n){var t="day";void 0!==n?t=n:e.main.isViewMonthly(e.main.currentView)?t="month":e.main.isViewYearly(e.main.currentView)&&(t="year"),e.main.currentViewDate=moment(e.main.currentViewDate).add(a,t).toDate()},e.main.isGoalDaily=function(e){return r.isGoalDaily(e)},e.main.isGoalMonthly=function(e){return r.isGoalMonthly(e)},e.main.isGoalYearly=function(e){return r.isGoalYearly(e)},e.main.isGoalLifeTime=function(e){return r.isGoalLifeTime(e)},e.main.isGoalYearlyOrLifeTime=function(e){return r.isGoalYearlyOrLifeTime(e)},e.main.isGoalCurrentlyComplete=function(a){return r.isGoalCompleteOnDate(a,e.main.currentViewDate)},e.main.isGoalActiveInCurrentView=function(a){var n=e.main.currentViewDate,t=moment();return moment(n).isSame(t,"day")&&(n=t.valueOf()),r.isGoalActiveOnDate(a,n)},e.main.getCurrentProgessDate=function(a){return r.getGoalProgressStringInRecurrenceOnDate(a,e.main.currentViewDate)},e.main.markGoalProgress=function(a,n,t){t.preventDefault(),t.stopPropagation(),r.markGoalProgressOnDate(a,n,e.main.currentViewDate)},e.main.getCurrentCompletionPercentageForGoal=function(a){return r.getGoalCompletionPercentageInRecurrenceOnDate(a,e.main.currentViewDate)},e.main.markGoalIncomplete=function(a,n){n.preventDefault(),n.stopPropagation(),r.markGoalProgressOnDate(a,"0",e.main.currentViewDate)},e.main.openGridDatePicker=function(a){a.preventDefault(),a.stopPropagation(),e.main.currentView.changeDate&&(e.main.gridDatePickerOpened=!0)},e.main.setModalGoalType=function(e){r.resetGoalModal(e)},e.main.enableView=function(a){e.main.currentViewDate=moment().startOf("day").toDate();var n=l.allViews[a],t=e.main.currentView;r.linkSettings.colorCodeByLinkPath&&(t.showColorByGroup||angular.equals(t,{}))&&(n.showColorByGroup||(r.linkSettings.colorCodeByLinkPath=!1,r.recolorGoals())),l.setCurrentView(a),e.main.currentView=l.currentView,e.main.isViewMonthly(e.main.currentView)?(e.main.currentDatePickerMode="month",e.main.currentDatePickerPopup="MMMM-yyyy"):e.main.isViewYearly(e.main.currentView)?(e.main.currentDatePickerMode="year",e.main.currentDatePickerPopup="yyyy"):(e.main.currentDatePickerMode="day",e.main.currentDatePickerPopup="EEE dd-MMMM-yyyy"),e.main.showReports=!1,e.main.showRewards=!1,e.main.showClaimReport=!1},e.main.changeOrderOfGoalsInCurrentView=function(e,a,n){l.reorderGoalsinCurrentView(e,a,n)},e.main.changeOrderOfPicturesInCurrentView=function(){l.savePicturesOrdersinView(e.main.currentView)},e.main.currentViewDate=moment().startOf("day").toDate(),e.main.currentDatePickerMode="day",e.main.currentDatePickerPopup="EEE dd-MMMM-yyyy",e.main.todayDate=moment().startOf("day").format(r.datePickerFormatString),e.main.pictureForModal={},e.main.linkViewDragEnabled=!0,e.main.dateOptions={startingDay:1,show_weeks:!1},e.main.currentUser=t.currentUser,e.main.showReportsNoteSection=!0,e.main.gridViewRearrangeGoals=!1,e.main.linkViewDragEnabled=e.main.gridViewRearrangeGoals,e.main.css="",e.main.bootstraps=[{name:"None",url:""},{name:"Cerulean",url:"cerulean"},{name:"Cosmo",url:"cosmo"},{name:"Cyborg",url:"cyborg"},{name:"Darkly",url:"darkly"},{name:"Flatly",url:"flatly"},{name:"Journal",url:"journal"},{name:"Lumen",url:"lumen"},{name:"Paper",url:"paper"},{name:"Readable",url:"readable"},{name:"Sandstone",url:"sandstone"},{name:"Simplex",url:"simplex"},{name:"Slate",url:"slate"},{name:"Spacelab",url:"spacelab"},{name:"Superhero",url:"superhero"},{name:"United",url:"united"},{name:"Yeti",url:"yeti"}],e.main.currentReportsTypeIDArray=s.currentReportsTypeIDArray,e.main.toggleGoalType=s.toggleGoalType,e.main.currentUserGoals=r.currentUserGoals,e.main.allPublicGoals=r.allPublicGoals,e.main.allVisibleGoalsFlatObject=r.visibleGoalsFlatObject,e.main.currentUserAllGoalsFlatArray=r.currentUserAllGoalsFlatArray,e.main.goalCompletionData=r.goalCompletionData,e.main.allGoalTypes=r.allGoalTypes,e.main.currentView={},e.main.allViews=l.allViews,e.main.allVisibleNotes=u.visibleNotesFlatObject,e.main.allPictures=o.allPictures,e.main.linkSettings=r.linkSettings,e.main.setCurrentUserBootstrapUrl=i.setCurrentUserBootstrapUrl;var p=function(){console.timeStamp("started_server_data_load - getAccountRoles"),i.getAccountRoles().then(function(){e.main.account_roles=i.account_roles,console.timeStamp("start_getAccounts"),i.getAccounts().then(function(){console.timeStamp("end_getAccounts"),e.main.css=i.currentUserData.bootstrapUrl,e.main.accounts=i.accounts,e.main.allGroups=i.allGroups,console.timeStamp("start_getNotes"),u.getNotes(e.main.currentUser.isManager()).then(function(){console.timeStamp("end_getNotes"),e.main.allVisibleNotes=u.visibleNotesFlatObject,e.main.unreadManagerNoteIDs=s.unreadNoteIDs}),console.timeStamp("start_getPics"),o.getPictures().then(function(a){console.timeStamp("end_getPics"),e.main.allPictures=o.allPictures}),console.timeStamp("start_getGoalTypes"),r.getGoalTypes().then(function(a){console.timeStamp("end_getGoalTypes"),console.timeStamp("start_getVisibleGoals"),r.getVisibleGoals(t.currentUser).then(function(a){console.timeStamp("end_getVisibleGoals"),console.timeStamp("start_getAllPublicGoals"),r.getAllPublicGoals().then(function(a){console.timeStamp("end_getAllPublicGoals"),e.main.allPublicGoals=r.allPublicGoals,e.main.allGoalTypes=r.allGoalTypes,e.main.currentUserGoals=r.currentUserGoals,e.main.allVisibleGoalsFlatObject=r.visibleGoalsFlatObject,e.main.currentUserAllGoalsFlatArray=r.currentUserAllGoalsFlatArray,e.main.unclaimedRewardIDs=r.unclaimedRewardIDs,e.main.linkSettings=r.linkSettings,console.timeStamp("start_getAllViews"),l.getAllViews().then(function(){console.timeStamp("end_getAllViews");var a=1;angular.forEach(l.allViews,function(e){void 0===e.goalArraysByType&&(e.goalArraysByType={}),void 0===e.goalIDsArraysByType&&(e.goalIDsArraysByType={}),angular.forEach(e.goalTypeIDs,function(a){void 0===e.goalIDsArraysByType[a]?e.goalArraysByType[a]=r.filterOnTypeOfGoal(a):(e.goalArraysByType[a]=[],angular.forEach(e.goalIDsArraysByType[a],function(n){e.goalArraysByType[a].push(r.visibleGoalsFlatObject[n])}))}),e.isInitial===!0&&(a=e.id)}),e.main.allViews=l.allViews,e.main.enableView(a),t.currentUser.isManager()?e.main.showReports=!0:e.main.showReports=!1,console.timeStamp("completed_server_data_function"),e.main.isInitialLoadDone=!0})})})})})})};p(),e.main.accounts=i.accounts,e.main.account_roles=i.account_roles,e.main.allGroups=i.allGroups}])}();
!function(){"use strict";angular.module("goalgrid").controller("NoteCtrl",["$scope","noteFactory","modalData","userFactory",function(e,t,o,n){e.noteModal={},e.noteModal.modalState=o,e.noteModal.newNote=t.newNote,e.noteModal.currentEdit=t.currentEdit,o.editOnly?e.noteModal.modalNotes=[t.visibleNotesFlatObject[o.note.id]]:e.noteModal.modalNotes=[],e.noteModal.returnSharedWithString=function(e){var a=n.currentUser.id===o.user.id,d=n.currentUser.id===o.managerID,l=(t.isManagerNote(e),t.isThisUsersNote(e)||a),r=t.isCurrentUserManagerOfNote(e)||d;return!l&&r?o.user.name:"my manager"},e.noteModal.resetNoteModal=function(){t.resetNoteModal(o.noteView)},e.noteModal.addNote=function(){var n=new Date;o.viewDate?(e.noteModal.newNote.timestamp=angular.copy(o.viewDate),e.noteModal.newNote.timestamp.setHours(n.getHours()),e.noteModal.newNote.timestamp.setMinutes(n.getMinutes()),e.noteModal.newNote.timestamp.setMilliseconds(n.getMilliseconds())):e.noteModal.newNote.timestamp=n,e.noteModal.newNote.timestamp=e.noteModal.newNote.timestamp.getTime(),e.noteModal.newNote.noteView=o.noteView,e.noteModal.newNote.managerID=o.managerID,e.noteModal.newNote.managerName=o.managerName,e.noteModal.newNote.userID=o.user.id,e.noteModal.newNote.private||(e.noteModal.newNote.private=!1);var a=angular.copy(e.noteModal.newNote);t.addNote(a).then(function(){o.addOnly&&(e.noteModal.resetNoteModal(),e.$close())}),t.resetNewNote(o.noteView)},e.noteModal.saveNote=function(n){var a=e.noteModal.currentEdit[n.id].note;t.updateNote(a).then(function(){o.editOnly&&(e.noteModal.resetNoteModal(),e.$close())}),e.noteModal.currentEdit[n.id]={}},e.noteModal.toggleDeleteNoteMode=function(t){e.noteModal.currentEdit[t].deleteMode=!e.noteModal.currentEdit[t].deleteMode},e.noteModal.deleteNote=function(o){t.deleteNote(o),e.noteModal.currentEdit[o]={},e.noteModal.modalState.editOnly&&(e.noteModal.resetNoteModal(),e.$close())}}])}();
!function(){"use strict";angular.module("goalgrid").controller("PictureCtrl",["$scope","pictureFactory","viewFactory","Upload","modalData",function(e,i,t,o,c){e.pictureModal={},e.pictureModal.modalData=c,e.pictureModal.resetPictureModal=function(){e.main.pictureForModal={selectionType:"file"},e.pictureModal.selectExisting=!1},e.pictureModal.convertFileToDataURL=function(i){i&&o.base64DataUrl(i).then(function(t){e.main.pictureForModal.src=t,e.main.pictureForModal.filename=i.name})},e.pictureModal.updatePictureSlot=function(){t.replacePicID(c.currentView.id,c.viewLeft,c.viewFirstColumn,c.picListIndex,e.pictureModal.selectedID),e.$close()},e.pictureModal.clearPictureSlot=function(){t.removePicFromView(c.currentView.id,c.viewLeft,c.viewFirstColumn,c.picListIndex),e.$close()},e.pictureModal.updateModalPicture=function(){e.main.pictureForModal.id?i.updatePicture(e.main.pictureForModal):i.addPicture(e.main.pictureForModal).then(function(i){e.main.addPicToThisView(c.viewLeft,c.viewFirstColumn,i),e.$close()})},e.pictureModal.deleteModalPicture=function(){t.removePictureFromAllViews(e.main.pictureForModal.id),i.deletePicture(e.main.pictureForModal.id).then(function(){e.$close()})}}])}();
!function(){"use strict";angular.module("goalgrid").controller("ReportsCtrl",["$scope","goalFactory","accountFactory","userFactory","reportsFactory","noteFactory","NgTableParams","$filter","$modal",function(r,e,t,o,n,a,s,i,p){r.reports={},r.reports.allVisibleNotes=a.visibleNotesFlatObject,r.reports.allAccounts=t.accounts,r.reports.showUser={},r.reports.showGroup={},r.reports.allGroups=t.allGroups,r.reports.currentReportFromDate=moment().startOf("month").toDate(),r.reports.currentReportToDate=moment().startOf("day").toDate(),r.reports.currentReportMaxFromDate=moment().startOf("day").format(e.datePickerFormatString),r.reports.startOfCurrentDate=moment().startOf("day").format(e.datePickerFormatString),r.reports.currentReportMinFromDate=moment(0).startOf("day").format(e.datePickerFormatString),r.reports.currentReportMinToDate=moment().startOf("month").format(e.datePickerFormatString),r.reports.currentReportsTypeIDArray=n.currentReportsTypeIDArray,r.reports.currentReportsPeriodText="days",r.reports.accountDropdownSettings={displayProp:"username",enableSearch:!0,smartButtonMaxItems:5,externalIdProp:""},r.reports.accountDropdownTexts={buttonDefaultText:"Select Users",dynamicButtonTextSuffix:"selected",checkAll:"Select All",uncheckAll:"Deselect All"},r.reports.numberOfMonthsCurrentlyInReportView=0,r.reports.reportMonthCounterArray=[0],r.reports.numberOfYearsCurrentlyInReportView=0,r.reports.reportYearCounterArray=[0],r.reports.goalReportShowDetails=!1,r.reports.notesToToggleStatus=[];var u={sorting:{goalTypeID:"asc"},count:100};r.reports.selectedReportsUserArray=[];var c=t.accounts[o.currentUser.id];o.currentUser.isManager()?angular.forEach(t.accounts,function(e){o.currentUser.id!==e.id&&r.reports.selectedReportsUserArray.push(e)}):c&&(r.reports.selectedReportsUserArray.push(c),r.reports.showUser[c.id]=!0,r.reports.showGroup.everyone=!0),r.reports.coachingReportSetAllNotes=function(){r.reports.coachingReportFilters.private="",r.reports.coachingReportFilters.managerID=""},r.reports.isThisNoteEditableByLoggedInUser=function(r){if(void 0!==r){var e=a.isManagerNote(r),t=a.isThisUsersNote(r),o=a.isCurrentUserManagerOfNote(r);return!(!t&&!o||t&&e)}},r.reports.isUserInUserArray=function(e){var t=_.findIndex(r.reports.selectedReportsUserArray,function(r){return r.id==e.id});return t!==-1};var l=function(t,o,n){var a=e.getStartOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportFromDate,0).getTime(),s=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,0).getTime(),i=t.timestamp>=a&&t.timestamp<=s;return i&&r.reports.isUserInUserArray({id:t.userID})};r.reports.coachingReportFilters={userID:r.reports.selectedReportsUserArray,managerID:"",private:""},r.reports.coachingTableParams=new s({sorting:{timestamp:"asc"},filter:r.reports.coachingReportFilters,count:1e5},{counts:[],filterDelay:0,getData:function(r,e){var o=i("orderObjectBy")(a.visibleNotesFlatObject,""),n={};angular.forEach(e.filter(),function(r,e){"userID"!==e&&(n[e]=r)});var s=e.filter()?i("filter")(o,n):o;s=i("filter")(s,l);var p=e.orderBy(),u=null;void 0!==e.sorting().userID&&(p=function(r){return t.accounts[r.userID].username},u="desc"===e.sorting().userID),void 0!==e.sorting().managerID&&(p=function(r){return r.managerID||0===r.managerID?t.accounts[r.managerID].username:""},u="desc"===e.sorting().managerID),void 0!==e.sorting().timestamp&&(p=function(r){return r.timestamp},u="desc"===e.sorting().timestamp);var c=e.sorting()?i("orderBy")(s,p,u):s;return r.resolve(c.slice((e.page()-1)*e.count(),e.page()*e.count())),r.promise}}),r.reports.getUsersFromGroup=function(r,e,o){var n={},a=t.allGroups[r];return e&&angular.forEach(a.managers,function(r,e){t.accounts[e]&&(n[e]=t.accounts[e])}),o&&("everyone"===r?angular.forEach(t.accounts,function(r){n[r.id]=r}):angular.forEach(a.members,function(r,e){t.accounts[e]&&(n[e]=t.accounts[e])})),n};var m=function(t,o){var n=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate),a=e.getGoalRewardObjectArray(n,r.reports.reportMonthCounterArray),s=i("filter")(a,r.filter),p=o.orderBy(),u=null;void 0!==o.sorting().claimReport&&(p=function(r){return 100==r.progress&&r.reward?r.claimDate?0:1:-1},u="desc"===o.sorting().claimReport),void 0!==o.sorting().progressDate&&(p=function(r){return moment(r.progressDateString)},u="desc"===o.sorting().progressDate);var c=o.sorting()?i("orderBy")(s,p,u):s;t.resolve(c.slice((o.page()-1)*o.count(),o.page()*o.count()))},g=function(t){return e.isGoalActiveOnDate(t,r.reports.currentReportToDate,"month")},d=function(t,o){var n=i("filter")(e.currentUserAllGoalsFlatArray,function(r){return 1!=r.goalTypeID&&!r.hideInRewards}),a=i("filter")(n,g),s=i("filter")(a,r.filter),p=o.orderBy(),u=null;void 0!==o.sorting().rewards&&(p=function(e){var t=r.reports.getRewardsForGoalOnCurrentReportWithIndex(e,0);if(!t)return"";var o=Object.keys(t)[0];if(!o)return"";var n=t[o];return n.rewardText},u="desc"===o.sorting().rewards),void 0!==o.sorting().progress&&(p=function(e){return parseInt(r.reports.getPercentageCompleteForCurrentReportWithIndex(e,0))},u="desc"===o.sorting().progress),void 0!==o.sorting().claimMain&&(p=function(e){if(100!=r.reports.getPercentageCompleteForCurrentReportWithIndex(e,0))return-1;if(!r.reports.getRewardsForGoalOnCurrentReportWithIndex(e,0))return-1;var t=r.reports.getRewardsForGoalOnCurrentReportWithIndex(e,0);if(!t)return 1;var o=Object.keys(t)[0];if(!o)return 1;var n=t[o],a=r.reports.getGoalRewardClaimedDateWithIndex(e,n,0);return a?0:1},u="desc"===o.sorting().claimMain);var c=o.sorting()?i("orderBy")(s,p,u):s;t.resolve(c.slice((o.page()-1)*o.count(),o.page()*o.count()))};r.reports.claimTableParams=new s(u,{counts:[],getData:m}),r.reports.rewardTableParams=new s(u,{counts:[],getData:d}),r.reports.getGoalRecurrenceStringWithIndex=function(t,o){var n=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,o);return e.getGoalRecurrenceStringOnDate(t,n)},r.reports.getRecurrenceArrayForGoalBasedOnCurrentDateRange=function(t){return e.getRecurrenceArrayForGoalBasedOnStartDateAndMonthIndexArray(t,r.reports.currentReportToDate,r.reports.reportMonthCounterArray)},r.reports.toggleShowClaimReport=function(){r.reports.showClaimReport=!r.reports.showClaimReport,r.reports.showClaimReport?r.reports.setViewToLatestSixMonths():r.reports.setViewToCurrentMonth()},r.reports.addAdditionalRewardRow=function(t,o){void 0===o&&(o=0);var n=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,o),a=!1,s=r.reports.getPercentageCompleteForCurrentReportWithIndex(t,0);"100"===s&&(a=!0),e.addRewardToGoalInRecurrenceOnDate(t,"",a,n)},r.reports.openRemoveRewardModal=function(t,o,n,a){void 0===a&&(a=0);e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,a);if(!o.managerID){if(""!==o.rewardText){var s={};return s.goal=t,s.reward=o,s.index=n,p.open({animation:!0,templateUrl:"static/views/modals/delete_reward.html",controller:["$scope","modalData",function(r,e){r.rewardModal={},r.rewardModal.modalData=e}],scope:r,resolve:{modalData:["$q",function(r){return r.when(s)}]}})}r.reports.removeReward(t,o,n,a)}},r.reports.removeReward=function(t,o,n,a){void 0===a&&(a=0);var s=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,a);e.removeRewardFromGoalInRecurrenceOnDate(t,o,s)},r.reports.toggleGoalRewardClaimedWithIndex=function(t,o,n,a){var s=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,n);e.toggleGoalRewardClaimedForDate(t,o,s,a)},r.reports.getGoalRewardClaimedDateWithIndex=function(t,o,n){var a=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,n);return e.getGoalRewardClaimedDateInRecurrenceOnDate(t,o,a)},r.reports.isNoteUnread=function(r){return n.isNoteUnread(r)},r.reports.toggleNoteReadStatus=function(r){n.isNoteUnread(r)?n.markNoteRead(r):n.markNoteUnread(r)},r.reports.addNoteToToggleList=function(e,t){void 0===r.reports.notesToToggleStatus&&(r.reports.notesToToggleStatus=[]),r.reports.notesToToggleStatus.push([e,t.target.checked])},r.$on("modal.closing",function(){for(var e=0;e<r.reports.notesToToggleStatus.length;e++)r.reports.notesToToggleStatus[e][1]?n.markNoteRead(r.reports.notesToToggleStatus[e][0]):n.markNoteUnread(r.reports.notesToToggleStatus[e][0])}),r.reports.getCurrentReportNotesForUserByMonthIndex=function(t,o){var n=e.getDateFromDateUsingMonthDiff(r.reports.currentReportToDate,o);return a.getSingleUserNotes(t,n,"MM/yyyy")},r.reports.getUnreadNotesForSingleUser=function(r){return a.getUnreadNotes(r)},r.reports.shouldHighLightDate=function(t){if(r.reports.reportMonthCounterArray.length>1)return"";var o=moment(r.reports.startOfCurrentDate,e.datePickerFormatString);return o.isSame(r.reports.currentReportToDate)&&t===moment().date()?"highlight":""},r.reports.colorDailySquare=function(t,o,n,a){if(t<=0)return"";var s=e.getDateFromDateUsingMonthDiff(r.reports.currentReportToDate,n);if(s.setDate(t),e.isGoalActiveOnDate(o,s)){var i=e.isGoalCompleteOnDate(o,s);if(o.singleGoalCompletion){var p=e.getGoalProgressStringInRecurrenceOnDate(o,s),u=moment(s).format("DD-MMM-YYYY");if(p===u&&i)return"background-color: "+o.customColor+"!important;"}else if(i)return"background-color: "+o.customColor+"!important;"}else if(!a)return"background-color: #888888!important;";return""},r.reports.colorPercentageSquare=function(t,o,n){return t<=0&&(t=-1),e.colorPercentageSquare(t,o,n,r.reports.currentReportToDate,!1)},r.reports.getRewardsGoalProgressStyles=function(e){var t={};return t.width=r.reports.getPercentageCompleteForCurrentReportWithIndex(e,0)+"%",t["background-color"]=e.color,t.border="1px solid "+e.color,t},r.reports.setViewToLatestSixMonths=function(){r.reports.currentReportFromDate=moment().startOf("month").startOf("day").toDate(),r.reports.currentReportToDate=moment().startOf("day").toDate();var e=moment(r.reports.currentReportFromDate).add(-5,"months");r.reports.currentReportFromDate=e.toDate(),r.reports.updateToFromAndMinMaxDates()},r.reports.setViewToCurrentMonth=function(){r.reports.currentReportFromDate=moment().startOf("month").startOf("day").toDate(),r.reports.currentReportToDate=moment().startOf("day").toDate(),r.reports.updateToFromAndMinMaxDates()},r.reports.setViewByMonthDiff=function(e){var t,o,n=moment(r.reports.currentReportFromDate),a=moment(r.reports.currentReportToDate),s=moment().subtract(1,"month").endOf("month").startOf("day");o=1===e&&a.isSame(s)?moment().startOf("day"):a.add(e,"months").endOf("month").startOf("day"),t=n.add(e,"months"),r.reports.currentReportFromDate=t.toDate(),r.reports.currentReportToDate=o.toDate(),r.reports.updateToFromAndMinMaxDates()},r.reports.openReportsDatePickers=function(e,t){e.preventDefault(),e.stopPropagation(),r.reports.reportsFromDatePickerOpened=t,r.reports.reportsToDatePickerOpened=!t},r.reports.monthPickerOptions={minMode:"month"},r.reports.getPercentageCompleteForCurrentReportWithIndex=function(t,o){var n;if("DD-MMM-YYYY"===e.allGoalTypes[t.goalTypeID].recurranceFormat){var a=r.reports.getGoalCompletionNumberForCurrentReportMonthsWithIndex(t,o),s=r.reports.getDaysForCurrentReportMonthsWithIndex(o);n=Math.round(a/s*100)+""}else{var i=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,o);n=e.getGoalCompletionPercentageInRecurrenceOnDate(t,i)}return n},r.reports.getRewardsForGoalOnCurrentReportWithIndex=function(t,o){var n=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,o);return e.getRewardsForGoalInRecurrenceOnDate(t,n)},r.reports.rewardTextChanged=function(t,o,n){var a=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,n),s=e.getGoalRecurrenceStringOnDate(t,a),i=e.getRewardsRefUsingRecurrenceString(t,s);i.child(o.id).set(o)},r.reports.getDaysForCurrentReportMonthsWithIndex=function(t){return e.getReportDaysUsingDateWithMonthDiff(r.reports.currentReportToDate,t)},r.reports.getGoalCompletionNumberForCurrentReportMonthsWithIndex=function(t,o){var n=e.getStartOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,o),a=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,o);return e.getGoalCompletionsForDateRange(t,n,a)},r.reports.getMonthStringUsingCurrentToAndDiff=function(t){var o=e.getMomentFromDateUsingMonthDiff(r.reports.currentReportToDate,t);return o.format("MMM-YYYY")},r.reports.getDateStringWithGoalAndIndex=function(t,o){var n=e.getMomentFromDateUsingMonthDiff(r.reports.currentReportToDate,o),a=e.getGoalsTypeRecurrenceFormat(t);return n.format(a)},r.reports.getDateFromDateUsingMonthDiff=function(r,t){return e.getDateFromDateUsingMonthDiff(r,t)};var f=function(){r.reports.currentReportMaxFromDate=moment(r.reports.currentReportToDate).format(e.datePickerFormatString),r.reports.currentReportMinToDate=moment(r.reports.currentReportFromDate).format(e.datePickerFormatString)},D=function(){r.reports.numberOfMonthsCurrentlyInReportView=moment(r.reports.currentReportToDate).diff(r.reports.currentReportFromDate,"month"),r.reports.reportMonthCounterArray.splice(0);for(var e=r.reports.numberOfMonthsCurrentlyInReportView;e>=0;e--)r.reports.reportMonthCounterArray.push(e);for(r.reports.numberOfYearsCurrentlyInReportView=moment(r.reports.currentReportToDate).startOf("year").diff(moment(r.reports.currentReportFromDate).startOf("year"),"year"),r.reports.reportYearCounterArray.splice(0),e=0;e<=r.reports.numberOfYearsCurrentlyInReportView;e++)r.reports.reportYearCounterArray.push(e)},h=function(){moment(r.reports.currentReportToDate).format("MM-YYYY")===moment().format("MM-YYYY")?r.reports.currentReportToDate=moment().startOf("day").toDate():r.reports.currentReportToDate=moment(r.reports.currentReportToDate).endOf("month").startOf("day").toDate()};r.reports.updateToFromAndMinMaxDates=function(){h(),D(),f(),r.reports.rewardTableParams.reload(),r.reports.claimTableParams.reload(),r.reports.coachingTableParams.reload()},r.reports.toggleGoalReportDetails=function(){r.reports.goalReportShowDetails=!r.reports.goalReportShowDetails},r.reports.getCurrentReportGoals=function(r,t){return t===o.currentUser.id?e.currentUserGoals?void 0===e.currentUserGoals[r]?{}:e.currentUserGoals[r]:{}:void 0===e.allPublicGoals[t]?{}:void 0===e.allPublicGoals[t][r]?{}:e.allPublicGoals[t][r]}}])}();
!function(){"use strict";angular.module("goalgrid").controller("ViewCtrl",["$scope","viewFactory",function(o,r){}])}();
!function(){"use strict";angular.module("goalgrid").factory("accountFactory",["$resource","$q","$cookies","firebaseFactory","FirebaseuiFactory","$timeout",function(e,r,a,n,s,o){function t(e,r){var a=!1;u.accounts[e.id]=r,u.accounts[e.id].groups=e.groups,r.groups&&r.groups.memberOf?angular.forEach(r.groups.memberOf,function(e,r){u.currentUserData.groups&&u.currentUserData.groups.managerOf&&u.currentUserData.groups.managerOf[r]&&(a=!0)}):"manager"===u.currentUserData.role&&"user"===e.role&&(a=!0),a||"admin"===u.currentUserData.role||u.currentUserData.id==r.id?"manager"===e.role&&(u.justManagers[e.id]=r):delete u.accounts[e.id]}var u={},c=n.usersRef,l=n.groupsRef,i=n.firebaseRef.child("roles"),d=i.child("_options");u.accounts={},u.account_roles={},u.allGroups={},u.currentUserData={},u.justManagers={};var m=null,g=function(e){return l.child(e)},f=function(e){return c.child(e.id).child("userData")},p=function(e){return c.child(e.id)};u.getCurrentUserData=function(e){console.timeStamp("inside_getAccountRoles-start_getCurrentUserData"),m||u.setCurrentUserID(e.uid);var a=r.defer();return angular.equals({},u.currentUserData)?f({id:m}).once("value",function(e){if(e){var r=e.val();r&&(u.currentUserData=r,console.timeStamp("inside_getAccountRoles-end_getCurrentUserData"),a.resolve(u.currentUserData))}},function(e){console.log("Could not access current user data"),console.timeStamp("inside_getAccountRoles-end_getCurrentUserData-ERROR"),console.log(e)}):a.resolve(u.currentUserData),a.promise};var h=function(e){var a=r.defer(),o=function(r){var s={userData:{id:r.uid,name:e.username,role:e.role.name,roleID:e.role.id,email:e.email,bootstrapUrl:"cerulean"},viewData:{}};e.groups&&(s.userData.groups=e.groups),console.log("Getting default view node to create user"),n.firebaseRef.child("defaultViews").once("value",function(e){var n=e.val();s.viewData.views=n,console.log("Creating user metadata"),p({id:r.uid}).set(s),a.resolve(s.userData)})};return s.createUserAuth({displayname:e.username,email:e.email,password:e.pw,rolename:e.role.name},o,function(e,r,a){console.log("Create user call failed: "+a)}),a.promise};u.setCurrentUserID=function(e){m=e,n.setThisUserRef(e)},u.setCurrentUserBootstrapUrl=function(e){var r=f(u.currentUserData);return r.child("bootstrapUrl").set(e)},u.getAccountRoles=function(){var e=r.defer(),a=[];u.accounts={};var n=u.getCurrentUserData();if("admin"===u.currentUserData.role)d.once("value",function(r){if(r){u.account_roles={};var a=r.val();angular.forEach(a,function(e){e.id&&(u.account_roles[e.id]=e)}),e.resolve(u.account_roles)}}),a.push(e.promise);else{u.account_roles={};var s=u.currentUserData.role,o=u.currentUserData.roleID;u.account_roles[o]={id:o,name:s}}return a.push(n),r.all(a).then(function(){var e={id:u.currentUserData.id,username:u.currentUserData.name,email:u.currentUserData.email};e.role=u.account_roles[u.currentUserData.roleID],t(u.currentUserData,e)})},u.getAccounts=function(){var e=r.defer(),a=[];return console.timeStamp("inside_getAccounts-start_serverAccounts"),"admin"!==u.currentUserData.role&&"manager"!==u.currentUserData.role||i.once("value",function(e){if(e){var r=e.val();angular.forEach(r,function(e,r){if("_options"!==r){var n={id:r},s=f(n).once("value",function(e){o(function(){if(e){var r=e.val();return!!r&&(n.username=r.name,n.role=u.account_roles[r.roleID],n.email=r.email,t(r,n),n)}})});a.push(s)}})}}),"admin"===u.currentUserData.role?l.once("value",function(r){u.allGroups=r.val(),e.resolve(u.accounts)}):e.resolve(u.accounts),e.promise};var v=function(e,r){var a=0;return u.allGroups[e]&&u.allGroups[e][r]&&angular.forEach(u.allGroups[e][r],function(e){e&&a++}),a},D=function(e){delete e.groups,e.selectedMemberOfArray.length&&(e.groups||(e.groups={}),e.groups.memberOf={},angular.forEach(e.selectedMemberOfArray,function(r){e.groups.memberOf[r.id]=!0})),e.selectedManagerOfArray.length&&(e.groups||(e.groups={}),e.groups.managerOf={},angular.forEach(e.selectedManagerOfArray,function(r){e.groups.managerOf[r.id]=!0}))},b=function(e){delete e.managers,delete e.members,e.selectedMembersArray&&e.selectedMembersArray.length&&(e.members={},angular.forEach(e.selectedMembersArray,function(r){e.members[r.id]=!0})),e.selectedManagersArray&&e.selectedManagersArray.length&&(e.managers={},angular.forEach(e.selectedManagersArray,function(r){e.managers[r.id]=!0}))},U=function(e){e.groups&&(angular.forEach(e.groups.memberOf,function(r,a){u.allGroups[a].members&&delete u.allGroups[a].members[e.id],g(a).child("members").child(e.id).set(null)}),angular.forEach(e.groups.managerOf,function(r,a){u.allGroups[a].managers&&delete u.allGroups[a].managers[e.id],g(a).child("managers").child(e.id).set(null)}))},O=function(e){var a=[];return angular.forEach(e.members,function(r,n){if(u.accounts[n]){u.accounts[n].groups&&u.accounts[n].groups.memberOf&&delete u.accounts[n].groups.memberOf[e.id];var s=f({id:n}).child("groups/memberOf").child(e.id).set(null);a.push(s)}}),angular.forEach(e.managers,function(r,n){if(u.accounts[n]){u.accounts[n].groups&&u.accounts[n].groups.managerOf&&delete u.accounts[n].groups.managerOf[e.id];var s=f({id:n}).child("groups/managerOf").child(e.id).set(null);a.push(s)}}),r.all(a)},G=function(e){e.groups&&(angular.forEach(e.groups.memberOf,function(r,a){u.allGroups[a].members||(u.allGroups[a].members={}),u.allGroups[a].members[e.id]=!0,g(a).child("members").child(e.id).set(!0)}),angular.forEach(e.groups.managerOf,function(r,a){u.allGroups[a].managers||(u.allGroups[a].managers={}),u.allGroups[a].managers[e.id]=!0,g(a).child("managers").child(e.id).set(!0)}))},A=function(e){var a=[];return angular.forEach(e.members,function(r,n){u.accounts[n].groups||(u.accounts[n].groups={}),u.accounts[n].groups.memberOf||(u.accounts[n].groups.memberOf={}),u.accounts[n].groups.memberOf[e.id]=!0;var s=f({id:n}).child("groups/memberOf").child(e.id).set(!0);a.push(s)}),angular.forEach(e.managers,function(r,n){u.accounts[n].groups||(u.accounts[n].groups={}),u.accounts[n].groups.managerOf||(u.accounts[n].groups.managerOf={}),u.accounts[n].groups.managerOf[e.id]=!0;var s=f({id:n}).child("groups/managerOf").child(e.id).set(!0);a.push(s)}),r.all(a)};u.getGroupMemberCount=function(e){return v(e,"members")},u.getGroupManagerCount=function(e){return v(e,"managers")};var M=function(e){g(e.id).child("id").set(e.id),g(e.id).child("name").set(e.name);var r=null;e.members&&(r=e.members),g(e.id).child("members").set(r);var a=null;e.managers&&(a=e.managers),g(e.id).child("managers").set(a)};return u.addGroup=function(e){return b(e),e.id=n.groupsRef.push().key,u.allGroups[e.id]=e,M(e),A(e),r.when(u.allGroups[e.id])},u.updateGroup=function(e){var a=r.defer();return O(e),b(e),A(e),M(e),u.allGroups[e.id]=e,a.resolve(u.allGroups[e.id]),a.promise},u.deleteGroup=function(e){O(u.allGroups[e]),g(e).set(null),delete u.allGroups[e]},u.addAccount=function(e){var a=r.defer();return D(e),h(e).then(function(r){G(e),u.accounts[r.id]=e,"manager"===e.role.name&&(u.justManagers[e.id]=e),a.resolve(u.accounts[r.id])}),a.promise},u.updateAccount=function(e){var a=r.defer(),n=function(r){U(e),"manager"!==e.role.name&&(e.selectedManagerOfArray=[]),D(e),delete u.justManagers[e.id],u.accounts[e.id]=e,"manager"===e.role.name&&(u.justManagers[e.id]=e);var n=f(e);n.child("name").set(e.username),n.child("role").set(e.role.name),n.child("roleID").set(e.role.id),n.child("email").set(e.email),e.groups?(n.child("groups").set(e.groups),G(e)):n.child("groups").set(null),console.log("User updated"),a.resolve(e)},o={id:e.id,displayname:e.username,email:e.email,password:e.pw,rolename:e.role.name};return e.pw&&""!==e.pw.trim()||delete o.password,s.updateUserAuth(o,n,function(e,r,a){console.log("Update user call failed: "+a)}),a.promise},u.deleteAccount=function(e){var a=r.defer(),n=function(r){U(u.accounts[e]),delete u.justManagers[e],delete u.accounts[e],p({id:e}).set(null),console.log("User deleted"),a.resolve(e)};return s.deleteUserAuth({id:e},n,function(e,r,a){console.log("Delete user call failed: "+a)}),a.promise},u}])}();
!function(){"use strict";angular.module("goalgrid").factory("firebaseFactory",["userFactory",function(e){var r=firebase.database().ref("/"),s={};return s.firebaseRef=r,s.usersRef=r.child("users"),s.groupsRef=r.child("groups"),s.setThisUserRef=function(e){s.thisUserRef=r.child("users").child(e)},s}])}();
!function(){"use strict";angular.module("goalgrid").factory("FirebaseuiFactory",["$firebaseAuth","$location","$window","$rootScope",function(e,t,n,r){var o={},a=firebase.app().options.projectId,u="https://us-central1-"+a+".cloudfunctions.net/api/",s=firebase.auth();return o.firebaseAuthObject=e(s),o.ui=new firebaseui.auth.AuthUI(s),o.dataRoot=firebase.database().ref(),o.userToken=null,o.isLoggedIn=function(){return o.firebaseAuthObject.$requireSignIn()},o.logout=function(){console.log("logout called"),s.signOut().then(function(){console.log("Log out successful. Redirecting"),r.$apply(function(){t.path("/login")})}).catch(function(e){console.log("Log out failed",e)})},o.createUserAuth=function(e,t,n){o.userToken?$.ajax({url:u+"newUser",type:"POST",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+o.userToken)},data:e,success:t,error:n}):console.error("Cannot create user, this account is not fully authenticated yet - please wait a moment and try again")},o.updateUserAuth=function(e,t,n){o.userToken?$.ajax({url:u+"updateUser",type:"POST",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+o.userToken)},data:e,success:t,error:n}):console.error("Cannot update user, this account is not fully authenticated yet - please wait a moment and try again")},o.deleteUserAuth=function(e,t,n){o.userToken?$.ajax({url:u+"deleteUser",type:"POST",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+o.userToken)},data:e,success:t,error:n}):console.error("Cannot delete user, this account is not fully authenticated yet - please wait a moment and try again")},o.getUser=function(){return s.currentUser&&s.currentUser.getIdToken(!0).then(function(e){o.userToken=e;var t=s.currentUser.uid;$.ajax({url:u+"roles?user="+t,type:"GET",beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+e)},success:function(e){console.log("Check admin call success")},error:function(e,t,n){console.log("Check admin call failed: "+n)}})}),s.currentUser},o}])}();
!function(){"use strict";angular.module("goalgrid").factory("goalFactory",["$q","$filter","$firebaseObject","accountFactory","firebaseFactory",function(e,a,o,r,t){var l={},n=t.firebaseRef.child("defaultGoalTypes"),i=t.thisUserRef.child("goalData"),c=i.child("goals");l.linkSettings={};var s=moment().startOf("day"),d=moment().startOf("month"),u=moment().startOf("year"),m=moment().startOf("year").subtract(1,"years"),f=({1:{range:0},2:{range:d.diff(s,"days")},3:{range:u.diff(s,"days")},4:{range:m.diff(s,"days")}},moment().startOf("day").toDate(),{1:{id:1,name:"Day",recurranceFormat:"DD-MMM-YYYY",defaultColor:"Lime",displayPercentage:!1},2:{id:2,name:"Month",recurranceFormat:"MMM-YYYY",defaultColor:"MistyRose",displayPercentage:!0},3:{id:3,name:"Year",recurranceFormat:"YYYY",defaultColor:"Cyan",displayPercentage:!0},4:{id:4,name:"Life",recurranceFormat:"none",defaultColor:"MediumSpringGreen",displayPercentage:!0}}),p=[{color:"darkorange"},{color:"deeppink"},{color:"yellow"},{color:"chartreuse"},{color:"cornflowerblue"},{color:"mediumspringgreen"},{color:"darkturquoise"},{color:"lawngreen"}];l.colorPaletteChoices=[["White","Lime","MistyRose","Cyan","MediumSpringGreen"],["DarkOrange","DeepPink","Yellow","Chartreuse","CornFlowerBlue"],["SkyBlue","Aquamarine","Coral","CornSilk","Fuchsia"],["Gold","GreenYellow","HoneyDew","Khaki","LightSteelBlue"],["PaleTurquoise","Orange","Tomato","Wheat","Thistle"]];l.currentUserGoals={},l.visibleGoalsFlatObject={},l.allPublicGoals={},l.newGoal={},l.currentUserAllGoalsFlatArray=[],l.allGoalTypes=f,l.defaultLinkPathColorArray=p,l.defaultNoLinkPathColor="lightgrey",l.newlinkPathColorIndex=10,l.datePickerFormatString="DD-MMMM-YYYY",l.currentEdit={},l.currentGoalModalType={},l.linkGroups={},l.unclaimedRewardIDs=[],l.getGoalFirebaseRefFromGoal=function(e){return c.child(e.goalTypeID).child(e.id)},l.getGoalCompletionStructureRef=function(e,a){return l.getGoalFirebaseRefFromGoal(e).child("completed/dates/"+a)},l.getRewardsRefUsingRecurrenceString=function(e,a){return l.getGoalCompletionStructureRef(e,a).child("/rewards")},l.isGoalActiveOnDate=function(e,a,o){var r=!0,t=!0,l=moment(a);return void 0===o&&(o="millisecond"),e.inactiveBeforeTimestamp&&(r=l.isAfter(e.inactiveBeforeTimestamp,o),!r&&l.isSame(e.inactiveBeforeTimestamp,o)&&(r=!0)),e.inactiveAfterTimestamp&&(t=l.isBefore(e.inactiveAfterTimestamp,o),!t&&l.isSame(e.inactiveAfterTimestamp,o)&&(t=!0)),r&&t},l.getGoalRewardObjectArray=function(e,a){var o=[];return angular.forEach(l.currentUserAllGoalsFlatArray,function(r){if(1!==r.goalTypeID){var t=l.getRecurrenceArrayForGoalBasedOnStartDateAndMonthIndexArray(r,e,a);angular.forEach(t,function(a){var t=l.getDateFromDateUsingMonthDiff(e,a);angular.forEach(l.getRewardsForGoalInRecurrenceOnDate(r,t),function(e){var n={},i=l.getGoalCompletionPercentageInRecurrenceOnDate(r,t),c=l.getGoalProgressStringInRecurrenceOnDate(r,t),s=l.getGoalRewardClaimedDateInRecurrenceOnDate(r,e,t);n.goal=r,n.reward=e,n.progress=i,n.progressDateString=c,n.claimDate=s,n.monthIndex=a,o.push(n)})})}}),o},l.removeRewardIDFromUnclaimedList=function(e){var a=_.indexOf(l.unclaimedRewardIDs,e);a!==-1&&l.unclaimedRewardIDs.splice(a,1)},l.addRewardIDToUnclaimedList=function(e){l.unclaimedRewardIDs.push(e)},l.addRewardToGoalInRecurrenceOnDate=function(e,a,o,r){var t=l.getGoalRecurrenceStringOnDate(e,r);void 0===e.completed&&(e.completed={}),void 0===e.completed.dates&&(e.completed.dates={}),void 0===e.completed.dates[t]&&(e.completed.dates[t]={}),void 0===e.completed.dates[t].rewards&&(e.completed.dates[t].rewards={});var n=l.getRewardsRefUsingRecurrenceString(e,t).push(),i={id:n.key,rewardText:a};e.completed.dates[t].rewards[i.id]=i,n.set(i),o&&l.addRewardIDToUnclaimedList(i.id)},l.removeRewardFromGoalInRecurrenceOnDate=function(e,a,o){var r=l.getGoalRecurrenceStringOnDate(e,o);l.removeRewardIDFromUnclaimedList(a.id),void 0!==e.completed&&void 0!==e.completed.dates&&void 0!==e.completed.dates[r]&&void 0!==e.completed.dates[r].rewards&&(delete e.completed.dates[r].rewards[a.id],l.getRewardsRefUsingRecurrenceString(e,r).child(a.id).set(null))},l.colorPercentageSquare=function(e,a,o,r,t){var n=10*e;if(n<0)return"";var i=l.getEndOfMonthDateFromDateUsingMonthDiff(r,o),c=l.getGoalCompletionPercentageInRecurrenceOnDate(a,i);return n>parseInt(c)?"":t?"background-color: "+a.color+"!important;":"background-color: "+a.customColor+"!important;"};var g=function(e){if(l.linkSettings.colorCodeByLinkPath)return e.linkColor?e.linkColor:l.defaultNoLinkPathColor;if(e.coloredByLinkPath=!1,e.customColor)return e.customColor;var a=l.allGoalTypes[e.goalTypeID];return a.defaultColor};l.recolorGoals=function(){angular.forEach(l.currentUserAllGoalsFlatArray,function(e){var a=(e.color,g(e));e.color=a})},l.resetNewGoal=function(e){var a=l.allGoalTypes[e];l.newGoal.goalTypeID=e,l.newGoal.completed={},l.newGoal.private=!1,l.newGoal.linkedGoalIds?l.newGoal.linkedGoalIds.splice(0):l.newGoal.linkedGoalIds=[],l.newGoal.goalText="",l.newGoal.customColor=a.defaultColor,l.newGoal.linkColor=void 0,l.newGoal.singleGoalCompletion=!0,l.newGoal.hideInRewards=!0,a.recurByDefault?l.newGoal.singleGoalCompletion=!1:l.newGoal.singleGoalCompletion=!0,a.autoHideIncompleteOneTimeGoalsByDefault?l.newGoal.autoHideIncompleteOneTimeGoals=!0:l.newGoal.autoHideIncompleteOneTimeGoals=!1,a.displayPercentage?l.newGoal.checkboxCompletion=!1:l.newGoal.checkboxCompletion=!0},l.resetGoalModal=function(e){l.currentGoalModalType=l.allGoalTypes[e],l.resetNewGoal(e),l.currentEdit={}},l.getGoalsTypeRecurrenceFormat=function(e){return l.allGoalTypes[e.goalTypeID].recurranceFormat},l.getReportDaysUsingDateWithMonthDiff=function(e,a){var o,r;if(0===a)return o=moment(e).startOf("day"),r=moment(l.getStartOfMonthDateFromDateUsingMonthDiff(e,a)),o.diff(r,"days")+1;var t=l.getMomentFromDateUsingMonthDiff(e,a);return t.add(1,"month"),new Date(t.year(),t.month(),0).getDate()},l.isGoalYearlyOrLifeTime=function(e){return l.isGoalLifeTime(e)||l.isGoalYearly(e)},l.isGoalDaily=function(e){return"DD-MMM-YYYY"===l.allGoalTypes[e.goalTypeID].recurranceFormat},l.isGoalMonthly=function(e){return"MMM-YYYY"===l.allGoalTypes[e.goalTypeID].recurranceFormat},l.isGoalYearly=function(e){return"YYYY"===l.allGoalTypes[e.goalTypeID].recurranceFormat},l.isGoalLifeTime=function(e){return"none"===l.allGoalTypes[e.goalTypeID].recurranceFormat},l.getDateFromDateUsingMonthDiff=function(e,a){return l.getMomentFromDateUsingMonthDiff(e,a).toDate()},l.getMomentFromDateUsingMonthDiff=function(e,a){var o=moment(angular.copy(e)).subtract(a,"months");return o},l.getStartOfMonthDateFromDateUsingMonthDiff=function(e,a){var o=moment(e).startOf("month").toDate();return l.getDateFromDateUsingMonthDiff(o,a)},l.getEndOfMonthDateFromDateUsingMonthDiff=function(e,a){var o=moment(e).endOf("month").startOf("day").toDate();return l.getDateFromDateUsingMonthDiff(o,a)},l.getGoalRecurrenceStringOnDate=function(e,a){var o,r=l.getGoalsTypeRecurrenceFormat(e);return o=e.singleGoalCompletion?"0":r&&"none"!==r?moment(a).format(r):"0"},l.getRecurrenceArrayForGoalBasedOnStartDateAndMonthIndexArray=function(e,a,o){var r=[],t={};return angular.forEach(o,function(o){var n=l.getEndOfMonthDateFromDateUsingMonthDiff(a,o),i=l.getGoalRecurrenceStringOnDate(e,n),c=l.isGoalActiveOnDate(e,n,"month"),s=c&&!t[i];e.singleGoalCompletion&&(s=c),s&&(t[i]=!0,r.push(o))}),r},l.isGoalCompleteOnDate=function(e,a){var o=l.getGoalRecurrenceStringOnDate(e,a);return void 0!==e.completed&&void 0!==e.completed.dates&&!(!e.completed.dates[o]||"100"!==e.completed.dates[o].percentage)},l.toggleGoalRewardClaimedForDate=function(e,a,o,r){var t=l.getGoalRecurrenceStringOnDate(e,o);if(e.completed.dates[t])if(e.completed.dates[t][a.id])delete e.completed.dates[t][a.id],r&&delete r.claimDate,l.unclaimedRewardIDs.push(a.id);else{var n=new Date;e.completed.dates[t][a.id]=n,r&&(r.claimDate=n),l.removeRewardIDFromUnclaimedList(a.id)}},l.getGoalRewardClaimedDateInRecurrenceOnDate=function(e,a,o){var r=l.getGoalRecurrenceStringOnDate(e,o);return void 0!==e.completed.dates[r]&&e.completed.dates[r][a.id]};var G=function(e,a,o){var r=null,t=moment(a),n=null;return l.isGoalDaily(e)?n="day":l.isGoalMonthly(e)?n="month":l.isGoalYearly(e)&&(n="year"),n&&(r="end"===o?t.endOf(n).valueOf():t.startOf(n).valueOf()),r};l.markGoalProgressOnDate=function(e,a,o){var r=l.getGoalRecurrenceStringOnDate(e,o),t=!1,n=!1,i=new Date;void 0===e.completed&&(e.completed={},e.completed.dates={}),void 0===e.completed.dates&&(e.completed.dates={}),e.completed.dates[r]?"100"===e.completed.dates[r].percentage?"100"!==a&&(n=!0):"100"===a&&(t=!0):(e.completed.dates[r]={},"100"===a&&(t=!0)),e.completed.dates[r].date=i,e.completed.dates[r].percentage=a,(t||n)&&angular.forEach(e.completed.dates[r].rewards,function(e){t&&l.unclaimedRewardIDs.push(e.id),n&&l.removeRewardIDFromUnclaimedList(e.id)});var c=l.getGoalCompletionStructureRef(e,r);c.child("date").set(i.getTime()),c.child("percentage").set(a),e.singleGoalCompletion&&("100"===a?e.inactiveAfterTimestamp=G(e,o,"end"):"0"===a&&(e.inactiveAfterTimestamp=null),l.getGoalFirebaseRefFromGoal(e).child("inactiveAfterTimestamp").set(e.inactiveAfterTimestamp))},l.getGoalCompletionPercentageInRecurrenceOnDate=function(e,a){var o=l.getGoalRecurrenceStringOnDate(e,a);return void 0===e.completed||void 0===e.completed.dates?"0":void 0===e.completed.dates[o]?"0":void 0===e.completed.dates[o].percentage?"0":e.completed.dates[o].percentage},l.getRewardsForGoalInRecurrenceOnDate=function(e,a){var o=l.getGoalRecurrenceStringOnDate(e,a);return void 0===e.completed||void 0===e.completed.dates?{}:void 0===e.completed.dates[o]?{}:e.completed.dates[o].rewards},l.getGoalProgressStringInRecurrenceOnDate=function(e,a){var o=l.getGoalRecurrenceStringOnDate(e,a);return void 0===e.completed||void 0===e.completed.dates?"":void 0===e.completed.dates[o]?"":moment(e.completed.dates[o].date).format("DD-MMM-YYYY")},l.getGoalCompletionsForDateRange=function(e,a,o){var r=0;return e.completed&&angular.forEach(e.completed.dates,function(e,t){if(e.percentage&&"100"===e.percentage){var l=moment(e.date),n=moment(a),i=moment(o);l.diff(n,"days")>=0&&l.diff(i,"days")<=0&&r++}}),r},l.getGoalTypes=function(){var a=e.defer();return i=t.thisUserRef.child("goalData"),c=i.child("goals"),i.once("value",function(e){var a=e.val();a&&a.linkSettings&&(l.linkSettings.colorCodeByLinkPath=a.linkSettings.colorCodeByLinkPath)}),n.once("value",function(e){l.allGoalTypes={};var o=1;angular.forEach(e.val(),function(e){e.id&&(l.allGoalTypes[e.id]=e,o=e.id)}),l.allGoalTypes[1]&&(o=1),l.currentGoalModalType=l.allGoalTypes[o],a.resolve(l.allGoalTypes)}),a.promise},l.currentUserGoals={},l.getAllPublicGoals=function(){var a=e.defer();return"admin"==r.currentUserData.role||"manager"==r.currentUserData.role?t.usersRef.once("value",function(e){var o=e.val();l.allPublicGoals={},angular.forEach(o,function(e){if(e.id){l.allPublicGoals[e.id]={};var a={};e.goalData&&(a=e.goalData.goals),angular.forEach(a,function(a){angular.forEach(a,function(a){a.private||(void 0===l.allPublicGoals[e.id][a.goalTypeID]&&(l.allPublicGoals[e.id][a.goalTypeID]={}),l.allPublicGoals[e.id][a.goalTypeID][a.id]=a)})})}}),a.resolve(l.allPublicGoals)}):(l.allPublicGoals={},a.resolve(l.allPublicGoals)),a.promise},l.getVisibleGoals=function(a){var o=e.defer();return a.managerOf||i.child("goals").once("value",function(e){var a=e.val();l.currentUserGoals={},a&&(l.currentUserGoals=a),angular.forEach(l.currentUserGoals,function(e,a){angular.forEach(e,function(e){l.currentUserAllGoalsFlatArray.push(e),l.visibleGoalsFlatObject[e.id]=e,e.linkColor&&(l.linkGroups[e.linkColor]||(l.linkGroups[e.linkColor]=[]),l.linkGroups[e.linkColor].push({id:e.id}))})})}),o.resolve(l.currentUserGoals),o.promise},l.filterOutOneTypeOfGoal=function(e){return a("filter")(l.currentUserAllGoalsFlatArray,{goalTypeID:"!"+e},!1)},l.filterOnTypeOfGoal=function(e){return a("filter")(l.currentUserAllGoalsFlatArray,{goalTypeID:e},!1)};var D=function(e,a){l.linkGroups[e]&&(_.remove(l.linkGroups[e],{id:a}),angular.forEach(l.linkGroups[e],function(e){var o=l.visibleGoalsFlatObject[e.id];_.remove(o.linkedGoalIds,{id:a})}))},v=function(e,a){l.linkGroups[e]||(l.linkGroups[e]=[]),angular.forEach(l.linkGroups[e],function(e){var o=l.visibleGoalsFlatObject[e.id];void 0===o.linkedGoalIds&&(o.linkedGoalIds=[]),o.linkedGoalIds.push({id:a})}),l.linkGroups[e].push({id:a})};return l.addGoal=function(a,o){var r=e.defer();if(a.id=c.push().key,a.completed={},a.completed.dates={},a.linkColor?(l.linkGroups[a.linkColor]||(l.linkGroups[a.linkColor]=[]),a.linkedGoalIds=angular.copy(l.linkGroups[a.linkColor]),v(a.linkColor,a.id)):(a.linkColor=null,a.linkedGoalIds=[]),a.color=g(a),void 0===l.currentUserGoals[a.goalTypeID]&&(l.currentUserGoals[a.goalTypeID]={}),a.createdTimestamp=firebase.database.ServerValue.TIMESTAMP,a.singleGoalCompletion){a.inactiveBeforeTimestamp=G(a,o,"start");l.allGoalTypes[a.goalTypeID];a.autoHideIncompleteOneTimeGoals&&(a.inactiveAfterTimestamp=G(a,o,"end"))}else delete a.autoHideIncompleteOneTimeGoals;return l.currentUserGoals[a.goalTypeID][a.id]=a,l.visibleGoalsFlatObject[a.id]=a,l.currentUserAllGoalsFlatArray.push(a),l.getGoalFirebaseRefFromGoal(a).set(a),r.resolve(a),r.promise},l.updateGoal=function(a){var o=e.defer(),r=l.currentUserGoals[a.goalTypeID][a.id];return r.linkColor!=a.linkColor&&(r.linkColor&&D(r.linkColor,a.id),a.linkColor?(l.linkGroups[a.linkColor]||(l.linkGroups[a.linkColor]=[]),a.linkedGoalIds=angular.copy(l.linkGroups[a.linkColor]),v(a.linkColor,a.id)):(l.linkSettings.colorCodeByLinkPath&&(a.color=l.allGoalTypes[a.goalTypeID].defaultColor),a.linkedGoalIds=[])),a.color=g(a),_.assign(l.currentUserGoals[a.goalTypeID][a.id],a),l.getGoalFirebaseRefFromGoal(a).set(a),o.resolve(a),o.promise},l.toggleGoalInactiveAfter=function(e,a){e.inactiveAfterTimestamp?e.inactiveAfterTimestamp=null:e.inactiveAfterTimestamp=a,l.getGoalFirebaseRefFromGoal(e).child("inactiveAfterTimestamp").set(e.inactiveAfterTimestamp)},l.findAllRewardIDsForGoal=function(e){var a=[];return e.completed&&e.completed.dates?(angular.forEach(e.completed.dates,function(e){angular.forEach(e.rewards,function(e){a.push(e.id)})}),a):a},l.deleteGoal=function(e){var a=l.visibleGoalsFlatObject[e];a.linkColor&&D(a.linkColor,e),angular.forEach(l.findAllRewardIDsForGoal(a),function(e){l.removeRewardIDFromUnclaimedList(e)});var o=a.goalTypeID;delete l.currentUserGoals[o][e],delete l.visibleGoalsFlatObject[e],_.remove(l.currentUserAllGoalsFlatArray,{id:e}),l.getGoalFirebaseRefFromGoal({id:e,goalTypeID:o}).set(null)},l}])}();
!function(){"use strict";angular.module("goalgrid").factory("noteFactory",["$q","$filter","$modal","$firebaseObject","firebaseFactory","userFactory","reportsFactory",function(e,t,a,n,r,i,o){var s={},l=r.thisUserRef.child("noteData").child("notes");s.visibleNotesFlatObject={},s.newNote={},s.currentEdit={};var u=function(e){return r.usersRef.child(e.userID+"/noteData")},c=function(e){return u(e).child("/notes/"+e.id)},d=function(e){return u(e).child("unreadNoteIDs/"+e.id)},m=function(e){d(e).set(!0)},v=function(e){d(e).set(null)};({1:{id:1,userID:3,managerID:null,timestamp:moment().subtract(1,"day").hour(16).minute(15).toDate().getTime(),private:!1,noteView:"Day",noteText:"Didn't get any tours today"},2:{id:2,userID:3,managerID:2,timestamp:moment().subtract(1,"day").hour(17).minute(5).toDate().getTime(),private:!1,noteView:"Manager",noteText:"Helped Sally practice her intent statement"},3:{id:3,userID:3,managerID:2,timestamp:moment().subtract(1,"month").hour(12).toDate().getTime(),private:!1,noteView:"Manager",noteText:"Helped Sally review the sales script"},4:{id:4,userID:3,managerID:null,timestamp:moment().subtract(2,"day").hour(9).minute(0).toDate().getTime(),private:!1,noteView:"Day",noteText:"Attended sales training class"},5:{id:5,userID:3,managerID:null,timestamp:moment().hour(5).minute(10).toDate().getTime(),private:!0,noteView:"Day",noteText:"Went for bike ride with kids"},6:{id:6,userID:3,managerID:2,timestamp:moment().subtract(2,"day").hour(12).toDate().getTime(),private:!0,noteView:"Manager",noteText:"Private observation - I decided to give a VIP client to Veronica instead of Sally"}});s.isManagerNote=function(e){return null!==e.managerID&&void 0!==e.managerID},s.isThisUsersNote=function(e){return e.userID===i.currentUser.id},s.isCurrentUserManagerOfNote=function(e){return e.managerID===i.currentUser.id},s.openNoteModal=function(e,t,n,r){return void 0===n&&(s.resetNoteModal(e),n={editOnly:!1,addOnly:!0,noteView:e,user:{},managerID:null,viewDate:new Date}),void 0===r&&(r="static/views/modals/notes/note_layout.html"),a.open({animation:!0,templateUrl:r,controller:"NoteCtrl",scope:t,resolve:{modalData:["$q",function(e){return e.when(n)}]}})},s.resetNewNote=function(e){s.newNote.id=0,s.newNote.userID=0,s.newNote.managerID=null,s.newNote.managerName=null,s.newNote.timestamp=(new Date).getTime(),s.newNote.private=!1,s.newNote.noteView=e,s.newNote.noteText=""},s.resetNoteModal=function(e){s.resetNewNote(e),s.currentEdit={}},s.getSingleUserNotes=function(e,a,n,r){var i=[];return angular.forEach(s.visibleNotesFlatObject,function(o){if(o.userID===e){var s=!0,l=!0;if(void 0!==a){var u="MM/dd/yyyy";void 0!==n&&(u=n);var c=t("date")(o.timestamp,u),d=t("date")(a,u);s=c===d}void 0!==r&&(l=o.noteView===r),s&&l&&i.push(o)}}),t("orderBy")(i,"timestamp")},s.getUnreadNotes=function(e){var a=[];return angular.forEach(s.visibleNotesFlatObject,function(t){t.userID===e&&t.managerID&&o.isNoteUnread(t.id)&&a.push(t)}),t("orderBy")(a,"timestamp")};var f=function(){i.currentUser.isManager()||angular.forEach(s.visibleNotesFlatObject,function(e){s.isManagerNote(e)&&s.isThisUsersNote(e)&&e.private&&delete s.visibleNotesFlatObject[e.id]})};return s.getNotes=function(t){var a=e.defer();if(t){var i=n(r.usersRef);i.$loaded().then(function(){s.visibleNotesFlatObject={},angular.forEach(i,function(e){var a={};e.noteData&&(a=e.noteData.notes),angular.forEach(a,function(e){e.private&&t&&!e.managerID||e.private&&!t&&e.managerID?angular.noop():s.visibleNotesFlatObject[e.id]=e})}),a.resolve(s.visibleNotesFlatObject)})}else s.visibleNotesFlatObject=n(l),s.visibleNotesFlatObject.$watch(function(){f()}),s.visibleNotesFlatObject.$loaded().then(function(){f(),a.resolve(s.visibleNotesFlatObject)});return a.promise},s.addNote=function(t){var a=e.defer();return t.id=u(t).child("notes").push().key,t.createdTimestamp=firebase.database.ServerValue.TIMESTAMP,s.visibleNotesFlatObject[t.id]=t,c(t).set(t),t.managerID&&!t.private&&m(t),a.resolve(t),a.promise},s.updateNote=function(t){var a=e.defer(),n=s.visibleNotesFlatObject[t.id];return n.managerID&&!n.private&&v(t),_.assign(s.visibleNotesFlatObject[t.id],t),c(t).set(t),t.managerID&&!t.private&&m(t),a.resolve(s.visibleNotesFlatObject[t.id]),a.promise},s.deleteNote=function(t){var a=e.defer(),n=s.visibleNotesFlatObject[t],r=n.userID,i=n.managerID,o={id:t,userID:r};return i&&v(o),delete s.visibleNotesFlatObject[t],c(o).set(null),a.resolve({}),a.promise},s}])}();
!function(){"use strict";angular.module("goalgrid").factory("pictureFactory",["$q","$firebaseObject","firebaseFactory",function(e,r,i){var t={},l=i.thisUserRef.child("pictures");t.allPictures={};var u=function(e){return l.child(e.id)};return t.addViewIDToPicture=function(e,r){t.allPictures[e.id].viewIDs[r]=!0,u(e).child("viewIDs/"+r).set(!0)},t.removeViewIDFromPicture=function(e,r){delete t.allPictures[e.id].viewIDs[r],u(e).child("viewIDs/"+r).set(null)},t.getPictures=function(){var r=e.defer();return l.once("value",function(e){var i=e.val();i&&(t.allPictures=i),r.resolve(t.allPictures)}),r.promise},t.updatePicture=function(r){var i=e.defer();return"url"===r.selectionType&&delete r.filename,_.assign(t.allPictures[r.id],r),u(r).set(r),i.resolve(t.allPictures[r.id]),i.promise},t.addPicture=function(r){var i=e.defer();return r.id=l.push().key,t.allPictures[r.id]=r,u(r).set(r),i.resolve(t.allPictures[r.id]),i.promise},t.deletePicture=function(r){var i=e.defer(),l={id:r};return delete t.allPictures[r],u(l).set(null),i.resolve({}),i.promise},t}])}();
!function(){"use strict";angular.module("goalgrid").factory("reportsFactory",["$q","$firebaseObject","firebaseFactory",function(r,e,t){var n={},o=t.thisUserRef.child("noteData").child("unreadNoteIDs");return n.currentReportsTypeIDArray=[1,2,3,4],n.unreadNoteIDs=e(o),n.isNoteUnread=function(r){return!!n.unreadNoteIDs&&n.unreadNoteIDs[r]},n.markNoteRead=function(r){o.child(r).set(null)},n.markNoteUnread=function(r){o.child(r).set(!0)},n.toggleGoalType=function(r){var e=n.currentReportsTypeIDArray.indexOf(r);e>-1?n.currentReportsTypeIDArray.splice(e,1):(n.currentReportsTypeIDArray.push(r),n.currentReportsTypeIDArray.sort(function(r,e){return r-e}))},n}])}();
!function(){"use strict";angular.module("goalgrid").factory("userFactory",["$cookies",function(r){var e={};return e.currentUser={},e.currentUser.isManager=function(){return"admin"===e.currentUser.role||"manager"===e.currentUser.role},e.currentUser.isAdmin=function(){return"admin"===e.currentUser.role},e}])}();
!function(){"use strict";angular.module("goalgrid").factory("viewFactory",["$q","$firebaseObject","firebaseFactory",function(e,r,i){var s={},t=(i.firebaseRef.child("defaultViews"),i.thisUserRef.child("viewData/views"));s.allViews={};return s.currentView={},s.currentView.goalArraysByType={},s.getViewSingleGoalTypeID=function(e){if(e.goalTypeIDs){var r=0,i=0;if(void 0!==e.goalTypeIDs.length)r=e.goalTypeIDs.length,i=0;else{var s=Object.keys(e.goalTypeIDs);r=s.length,i=s[0]}return void 0!==r&&1===r&&void 0!==i&&void 0!==e.goalTypeIDs[i]?e.goalTypeIDs[i]:null}return null},s.setCurrentView=function(e){s.currentView=s.allViews[e]},s.replacePicID=function(e,r,i,t,c){if(void 0!==r&&void 0!==i){var l=s.allViews[e];if(!l.pictureIDs)return;if(r){if(!l.pictureIDs.left)return;if(i){if(!l.pictureIDs.left.first)return;t===-1?l.pictureIDs.left.first.push(c):l.pictureIDs.left.first[t]=c}else{if(!l.pictureIDs.left.second)return;t===-1?l.pictureIDs.left.second.push(c):l.pictureIDs.left.second[t]=c}}else{if(!l.pictureIDs.right)return;if(i){if(!l.pictureIDs.right.first)return;t===-1?l.pictureIDs.right.first.push(c):l.pictureIDs.right.first[t]=c}else{if(!l.pictureIDs.right.second)return;t===-1?l.pictureIDs.right.second.push(c):l.pictureIDs.right.second[t]=c}}s.savePicturesOrdersinView(l)}},s.removePicFromView=function(e,r,i,t){if(void 0!==r&&void 0!==i){var c=s.allViews[e];if(!c.pictureIDs)return;if(r){if(!c.pictureIDs.left)return;if(i){if(!c.pictureIDs.left.first)return;c.pictureIDs.left.first.splice(t,1)}else{if(!c.pictureIDs.left.second)return;c.pictureIDs.left.second.splice(t,1)}}else{if(!c.pictureIDs.right)return;if(i){if(!c.pictureIDs.right.first)return;c.pictureIDs.right.first.splice(t,1)}else{if(!c.pictureIDs.right.second)return;c.pictureIDs.right.second.splice(t,1)}}s.savePicturesOrdersinView(c)}},s.addPicToView=function(e,r,i,t){if(void 0!==r&&void 0!==i){var c=s.allViews[e];c.pictureIDs||(c.pictureIDs={}),r?(c.pictureIDs.left||(c.pictureIDs.left={}),i?(c.pictureIDs.left.first||(c.pictureIDs.left.first=[]),c.pictureIDs.left.first.push(t.id)):(c.pictureIDs.left.second||(c.pictureIDs.left.second=[]),c.pictureIDs.left.second.push(t.id))):(c.pictureIDs.right||(c.pictureIDs.right={}),i?(c.pictureIDs.right.first||(c.pictureIDs.right.first=[]),c.pictureIDs.right.first.push(t.id)):(c.pictureIDs.right.second||(c.pictureIDs.right.second=[]),c.pictureIDs.right.second.push(t.id))),s.savePicturesOrdersinView(c)}},s.removePictureFromAllViews=function(e){angular.forEach(s.allViews,function(r){var i,t,c,l;r.pictureIDs&&(r.pictureIDs.left&&(r.pictureIDs.left.first&&(i=r.pictureIDs.left.first.indexOf(e),i!==-1&&r.pictureIDs.left.first.splice(i,1)),r.pictureIDs.left.second&&(t=r.pictureIDs.left.second.indexOf(e),t!==-1&&r.pictureIDs.left.second.splice(t,1))),r.pictureIDs.right&&(r.pictureIDs.right.first&&(c=r.pictureIDs.right.first.indexOf(e),c!==-1&&r.pictureIDs.right.first.splice(c,1)),r.pictureIDs.right.second&&(l=r.pictureIDs.right.second.indexOf(e),l!==-1&&r.pictureIDs.right.second.splice(l,1))),s.savePicturesOrdersinView(r))})},s.addGoalToAllViews=function(e){var r=e.goalTypeID;angular.forEach(s.allViews,function(i){_.contains(i.goalTypeIDs,r)&&(void 0===i.goalArraysByType&&(i.goalArraysByType={}),void 0===i.goalIDsArraysByType&&(i.goalIDsArraysByType={}),void 0===i.goalArraysByType[r]&&(i.goalArraysByType[r]=[]),void 0===i.goalIDsArraysByType[r]&&(i.goalIDsArraysByType[r]=[]),i.goalArraysByType[r].push(e),i.goalIDsArraysByType[r].push(e.id),t.child(i.id+"/goalIDsArraysByType/"+r).set(i.goalIDsArraysByType[r]))})},s.removeGoalFromAllViews=function(e,r){angular.forEach(s.allViews,function(i){if(_.contains(i.goalTypeIDs,r)){var s=_.findIndex(i.goalArraysByType[r],function(r){return r.id==e});s!==-1&&i.goalArraysByType[r].splice(s,1);var c=_.findIndex(i.goalIDsArraysByType[r],function(r){return r==e});c!==-1&&(i.goalIDsArraysByType[r].splice(c,1),t.child(i.id+"/goalIDsArraysByType/"+r).set(i.goalIDsArraysByType[r]))}})},s.getAllViews=function(){var r=e.defer();return t.once("value",function(e){s.allViews={},angular.forEach(e.val(),function(e){e.id&&(s.allViews[e.id]=e)}),r.resolve(s.allViews)}),r.promise},s.updateView=function(r){var i=e.defer();return s.allViews[r.id].url=r.url,i.resolve(s.allViews[r.id]),i.promise},s.reorderGoalsinCurrentView=function(e,r,i){var c=s.currentView,l=e.goalTypeID;c.goalIDsArraysByType[l].splice(r,1),c.goalIDsArraysByType[l].splice(i,0,e.id),t.child(c.id+"/goalIDsArraysByType/"+l).set(c.goalIDsArraysByType[l])},s.savePicturesOrdersinView=function(e){e.pictureIDs&&t.child(e.id+"/pictureIDs").set(e.pictureIDs)},s}])}();